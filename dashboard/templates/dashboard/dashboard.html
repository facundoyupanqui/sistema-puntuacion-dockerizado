{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- DASHBOARD -->
<section id="dashboard" class="view active">
  <div class="grid">
    <div class="card" style="grid-column:span 4">
      <div class="body kpi">
        <div>
          <div class="trend">Puntos totales (<span id="periodText">{{ period|title }}</span>)</div>
          <strong id="totalPoints">{{ total_points }}</strong>
        </div>
        <span class="badge" id="pointsBadge">📊 Puntos</span>
      </div>
    </div>
    <div class="card" style="grid-column:span 4">
      <div class="body kpi">
        <div>
          <div class="trend">Mi posición</div>
          <strong id="userPosition">{{ user_position }}</strong>
        </div>
        <span class="badge" id="positionBadge">🏆 Ranking</span>
      </div>
    </div>
    <div class="card" style="grid-column:span 4">
      <div class="body kpi">
        <div>
          <div class="trend">Días restantes</div>
          <strong id="daysLeft">{{ days_left }}</strong>
        </div>
        <span class="badge" id="daysBadge">⏰ Quincena</span>
      </div>
    </div>

    <div class="card" style="grid-column:span 8">
      <div class="body">
        <h3>Ranking <span id="rankingPeriod">{{ period|title }}</span></h3>
        <table id="rankingTable">
          <thead>
            <tr><th>#</th><th>Nombre</th><th>Equipo</th><th>Puntos</th><th>Actividades</th></tr>
          </thead>
          <tbody id="rankingBody">
            {% for item in ranking %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ item.user.name }}</td>
              <td>{{ item.user.team.name|default:"Sin equipo" }}</td>
              <td>{{ item.total }}</td>
              <td>{{ item.activities_count }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="export-btns">
          <a class="btn success" href="{% url 'dashboard:export_ranking_excel' %}?period={{ period }}">📊 Exportar Excel</a>
          <a class="btn primary" href="{% url 'dashboard:export_ranking_pdf' %}?period={{ period }}">📄 Exportar PDF</a>
        </div>
      </div>
    </div>

    <div class="card" style="grid-column:span 4">
      <div class="body">
        <h3>Mis puntos</h3>
        <div id="userPoints">
          <div style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span>Commit válido:</span>
              <strong id="userCommits">{{ user_points.commit }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span>Sprint Review:</span>
              <strong id="userSprints">{{ user_points.sprint }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span>Llegar temprano:</span>
              <strong id="userEarly">{{ user_points.early }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span>Completar sistema:</span>
              <strong id="userSystem">{{ user_points.system }}</strong>
            </div>
            <hr style="border-color: var(--muted); margin: 12px 0;">
            <div style="display: flex; justify-content: space-between; font-size: 18px; color: var(--brand);">
              <span>Total:</span>
              <strong id="userTotal">{{ user_points.total }}</strong>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}